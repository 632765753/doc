## 企业微信的功能

* 通讯录管理

  ​	企业可以将已有的通讯录跟企业微信通讯录同步，避免同时维护多套通讯录

* 应用管理

  ​	在企业微信中创建应用后，企业可以将已有的系统以应用方式接入企业微信，为企业提供丰富的办公应用

* 消息推送

  ​	企业的通知可以快速触达成员，也可以接收成员发来的消息，让信息传递更高效

* 身份验证

  ​	通过OAuth2识别用户身份，成员访问企业网页时可以免密码自动登录

* 移动端SDK

  ​	JS-SDK可以调用企业微信原生客户端的能力，提升成员的使用体验。企业微信登录、分享SDK帮助移动应用实现快速登陆、内容分享。

## 开始开发

### 术语介绍

​	corpid：每个企业都拥有唯一的corpid，获取此信息可在管理后台“我的企业”－“企业信息”下查看“企业ID”（需要有管理员权限）

​	userid： 每个成员都有唯一的userid，即所谓“帐号”。在管理后台->“通讯录”->点进某个成员的详情页，可以看到。

​	部门id： 每个部门都有唯一的id，在管理后台->“通讯录”->“组织架构”->点击某个部门右边的小圆点可以看到

​	agentid: 每个应用都有唯一的agentid。在管理后台->“企业应用”->点进应用，即可看到agentid。

​	secret：secret是企业应用里面用于保障数据安全的“钥匙”，每一个应用都有一个独立的访问密钥，为了保证数据的安全，secret务必不能泄漏。

​	access_token：access_token是企业后台去企业微信的后台获取信息时的重要票据，由corpid和secret产生。所有接口在通信时都需要携带此信息用于验证接口的访问权限

### 开发步骤

使用access_token来访问企业微信的接口。需要注意的是，所有的接口需使用Https协议、Json数据格式、UTF8编码。

1. 获取secret

2. 获取access_token

3. 缓存和刷新access_token

   缓存access_token，用于后续接口的调用（不能频繁调用gettoken接口，否则会受到频率拦截）。当access_token失效或过期时，需要重新获取。

   - access_token的有效期通过返回的expires_in来传达，正常情况下为7200秒（2小时），有效期内重复获取返回相同结果，过期后获取会返回新的access_token。
   - 由于企业微信每个应用的access_token是彼此独立的，所以进行缓存时需要区分应用来进行存储。
   - access_token至少保留512字节的存储空间。

4. 开发应用

5. 参考官方文档 http://work.weixin.qq.com/api/doc#10013

### 发送应用消息

消息类型

文本消息、图片消息、语音消息、视频消息、文件消息、文本卡片消息、图文消息、图文消息（mpnews）、小程序通知消息
发送消息
文本消息:

	1.调用企业微信>应用管理>获取应用列表的api，获取到agentid；
	2.调用企业微信>通信录管理>部门管理>获取部门列表的api，获取到部门id；
	3.调用企业微信>通信录管理>成员管理>获取部门成员详情的api，获取到部门成员的userid；
	4.编写文本消息内容，然后调用企业微信的发送消息的接口。
非文本消息：
	1.调用企业微信>素材管理>上传临时素材api，上传成功后企业微信会返回media_id；</br>
	其他步骤和文本消息一致</br>
















​	

